"use strict";(self.webpackChunkarc=self.webpackChunkarc||[]).push([[4530],{5480:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>o});var s=n(4848),r=n(8453);const i={title:"Filtering Input/Output"},l=void 0,a={id:"dsl/filters",title:"Filtering Input/Output",description:"The input and output of Agents can be filtered/transformed using the filterInput and filterOutput blocks",source:"@site/docs/01-dsl/filters.md",sourceDirName:"01-dsl",slug:"/dsl/filters",permalink:"/arc/docs/dsl/filters",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Filtering Input/Output"},sidebar:"tutorialSidebar",previous:{title:"Extensions",permalink:"/arc/docs/dsl/extensions"},next:{title:"Quickstart",permalink:"/arc/docs/quickstart"}},d={},o=[{value:"Overriding In/Output",id:"overriding-inoutput",level:3},{value:"The breakWith function",id:"the-breakwith-function",level:3},{value:"Replacing values",id:"replacing-values",level:3},{value:"Removing values",id:"removing-values",level:3},{value:"Custom Filter classes",id:"custom-filter-classes",level:3}];function c(e){const t={code:"code",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["The input and output of Agents can be filtered/transformed using the ",(0,s.jsx)(t.code,{children:"filterInput"})," and ",(0,s.jsx)(t.code,{children:"filterOutput"})," blocks\nrespectively."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"FilterInput"}),"\nThe filterInput blocks have access to the following fields:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"input"}),(0,s.jsx)(t.td,{children:"Conversation"}),(0,s.jsx)(t.td,{children:"The entire conversation."}),(0,s.jsx)(t.td,{children:"writable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"inputMessage"}),(0,s.jsx)(t.td,{children:"ConversationMessage"}),(0,s.jsx)(t.td,{children:"The latest message of the conversation."}),(0,s.jsx)(t.td,{children:"writable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"message"}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsx)(t.td,{children:"The content of the latest message of the conversation."}),(0,s.jsx)(t.td,{children:"writable"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"FilterOutput"}),"\nThe filterInput blocks have access to the following fields:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"input"}),(0,s.jsx)(t.td,{children:"Conversation"}),(0,s.jsx)(t.td,{children:"The conversation that was provided as input."}),(0,s.jsx)(t.td,{children:"readonly"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"output"}),(0,s.jsx)(t.td,{children:"Conversation"}),(0,s.jsx)(t.td,{children:"The conversation plus the output message."}),(0,s.jsx)(t.td,{children:"writable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"outputMessage"}),(0,s.jsx)(t.td,{children:"ConversationMessage"}),(0,s.jsx)(t.td,{children:"The message generated by the Agent."}),(0,s.jsx)(t.td,{children:"writable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"message"}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsx)(t.td,{children:"The content of message generated by the Agent."}),(0,s.jsx)(t.td,{children:"writable"})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"overriding-inoutput",children:"Overriding In/Output"}),"\n",(0,s.jsxs)(t.p,{children:["Filters can be used change the input and output of the conversation.\nSimply assign a new value to one of the message fields,\ni.e. ",(0,s.jsx)(t.code,{children:"message"}),", ",(0,s.jsx)(t.code,{children:"inputMessage"}),", ",(0,s.jsx)(t.code,{children:"outputMessage"}),", ",(0,s.jsx)(t.code,{children:"input"}),", or ",(0,s.jsx)(t.code,{children:"output"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    systemPrompt = { """ Some system prompt """ }\n    filterInput {\n        message = "This is the input message $message"\n    }\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"the-breakwith-function",children:"The breakWith function"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"breakWith"})," function can be used to stop the agent from further\nprocessing the message and a return a dedicated response.\nThis is similar to the throwing an exception with the difference\nthat the Agent does not fail, but instead returns the provided message."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    systemPrompt = { """ Some system prompt """ }\n    filterInput {\n        val eval = llm("""\n          Evaluate if the following input is referring to bananas. \n          If so return BANANAS otherwise return CONTINUE.\n          Input: $message""").getOrNull()\n\n        if ("BANANAS" == eval?.content) {\n            breakWith("I cannot answer questions about bananas...")\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"replacing-values",children:"Replacing values"}),"\n",(0,s.jsxs)(t.p,{children:["Within the filter blocks the keyword ",(0,s.jsx)(t.code,{children:"replaces"})," can be used to replace\noccurrences of values with new values."]}),"\n",(0,s.jsx)(t.p,{children:"Example"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    systemPrompt = { """ Some system prompt """ }\n    filterInput {\n        "A transformed question" replaces "A question"\n        "A new message replacing the old" replaces ".*".toRegex()\n    }\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"removing-values",children:"Removing values"}),"\n",(0,s.jsxs)(t.p,{children:["Within the filter blocks the unaryMinus on String and Regex ",(0,s.jsx)(t.code,{children:"-"})," can be used to remove\nvalues."]}),"\n",(0,s.jsx)(t.p,{children:"Example"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    systemPrompt = { """ Some system prompt """ }\n    filterInput {\n        -"Bad Word"\n        -"Malware.*".toRegex()\n    }\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"custom-filter-classes",children:"Custom Filter classes"}),"\n",(0,s.jsxs)(t.p,{children:["Sometimes filter logic can be complex, or you may wish to reuse filters. In these cases, the ",(0,s.jsx)(t.code,{children:"AgentFilter"}),"\ninterface can be used."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kt",children:"fun interface AgentFilter {\n    /**\n     * Filters or transform Conversation Messages.\n     * If the fun returns null, the message will be removed from the conversation transcript.\n     */\n    suspend fun filter(message: ConversationMessage): ConversationMessage?\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Any ",(0,s.jsx)(t.code,{children:"AgentFilter"})," implementation on the classpath, can be added to the ",(0,s.jsx)(t.code,{children:"filterInput"})," and ",(0,s.jsx)(t.code,{children:"filterOutput"})," blocks using\nthe UnaryPlus ",(0,s.jsx)(t.code,{children:"+"})," operator."]}),"\n",(0,s.jsxs)(t.p,{children:["For example, adding a custom filter class ",(0,s.jsx)(t.code,{children:"MyFilter"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kts",children:'agent {\n    name = "weather"\n    description = "Agent that provides weather data."\n    systemPrompt = { """ Some system prompt """ }\n    filterInput {\n        +MyFilter::class // context is used to lookup instance of MyFilter\n        +MyFilter() // MyFilter is directly instantiated\n    }\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Filters can be directly instantiated in the filter blocks, or if the filter class is provided,\nthen a matching bean will be retrieved from the context, for example, the Spring Boot container."})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var s=n(6540);const r={},i=s.createContext(r);function l(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);